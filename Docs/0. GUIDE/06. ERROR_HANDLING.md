ERROR_HANDLING.md
경로: docs/ERROR_HANDLING.md

markdown
복사
편집
# 오류 처리 및 복구 프로세스

이 문서는 프로젝트 내에서 발생할 수 있는 주요 오류 유형과 이를 처리하기 위한 방법론을 설명합니다. 시스템의 안정성과 지속 가능성을 보장하기 위해 모든 모듈에서 오류를 효과적으로 식별, 로깅, 복구할 수 있는 메커니즘을 제공합니다.

---

## 주요 오류 유형 및 복구 방안

### 1. 데이터 수집 오류
- **오류 유형**:
  - 거래소 API 호출 실패.
  - 네트워크 불안정.
  - 데이터 형식 불일치.
- **복구 방안**:
  - 연결 실패 시 백오프(backoff) 전략 적용.
  - 최대 재시도 횟수 초과 시 텔레그램 알림 전송.
  - 로그 기록 후 수동 복구 또는 자동 재시작.

### 2. 신호 생성 오류
- **오류 유형**:
  - AI 모델 예측 실패.
  - 학습 데이터 부족 또는 품질 문제.
- **복구 방안**:
  - 잘못된 데이터 필터링 후 재처리.
  - 학습 체크포인트를 로드하여 모델 복구.
  - 발생한 오류를 대시보드에 시각적으로 표시.

### 3. 매매 실행 오류
- **오류 유형**:
  - 주문 실패.
  - 거래소 API 제한 초과.
  - 주문 상태 비동기 처리 실패.
- **복구 방안**:
  - 주문 실패 시 재시도 로직 적용.
  - API 제한 초과 시 일정 시간 대기 후 재시작.
  - 장애 발생 시 텔레그램 알림 전송.

---

## 주요 모듈별 오류 처리
### 데이터 수집 모듈 (`data/`)
- **처리 방식**:
  - API 호출 실패 시 재시도.
  - 데이터 변환 오류 시 기본값 대체.
  - 로그 기록 및 관리자 알림.

### 매매 실행 모듈 (`execution/`)
- **처리 방식**:
  - 주문 상태 비동기 문제를 동기화 메커니즘으로 해결.
  - 장애 발생 시 텔레그램 알림 전송.

### 신호 생성 모듈 (`signals/`)
- **처리 방식**:
  - 모델 입력 데이터 검증 후 오류 데이터 제거.
  - 모델 예측 실패 시 학습 데이터 재학습 트리거.

---

## 텔레그램 알림 연동
- **알림 조건**:
  - API 호출 실패가 3회 이상 발생한 경우.
  - 주문 상태가 "failed"로 반환된 경우.
  - 모델 예측 실패율이 10%를 초과한 경우.
- **구현 파일**: `utils/telegram_alerts.py`
- **예제 메시지**:
[ALERT] 데이터 수집 오류 모듈: data/collector.py 원인: API 호출 실패 시간: 2025-01-22 10:45:30

---

## 복구 프로세스 예제
### 시나리오 1: 거래소 API 호출 실패
1. 오류 로그 기록 (`utils/logger.py` 사용).
2. 백오프(backoff) 전략으로 3회 재시도.
3. 3회 실패 시 텔레그램 알림 전송.
4. API 복구 시 데이터 수집 자동 재개.

### 시나리오 2: 주문 실패
1. 주문 실패 로그 기록.
2. 재시도 로직 적용 (최대 2회).
3. 복구 실패 시 주문 취소 및 텔레그램 알림 전송.

---

## 구현 세부 사항
- **로깅**:
- 로그 파일 경로: `logs/errors.log`.
- 로그 포맷: `[시간] [모듈] [오류 유형] [세부 메시지]`.
- **복구**:
- 복구 스크립트 경로: `scripts/recover.sh`.
- 스크립트 실행 명령:
  ```bash
  bash scripts/recover.sh
  ```

---

## 참고 문서
- [MODULE_GUIDE.md](MODULE_GUIDE.md)
- [API_REFERENCE.md](API_REFERENCE.md)
- [TELEGRAM_ALERT.md](TELEGRAM_ALERT.md)
- [CICD_SETUP.md](CICD_SETUP.md)
- [DEVELOPMENT_PLAN.md](DEVELOPMENT_PLAN.md)
